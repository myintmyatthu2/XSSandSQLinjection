<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Security Dashboard - AOD Security Lab</title>
    <style>
        body { font-family: system-ui, Arial, sans-serif; margin: 20px; line-height: 1.6; }
        header a { margin-right: 15px; text-decoration: none; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .alert { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .alert-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-danger { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .security-status { padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
        .security-enabled { background-color: #d4edda; color: #155724; padding: 5px; border-radius: 3px; }
        .security-disabled { background-color: #f8d7da; color: #721c24; padding: 5px; border-radius: 3px; }
        .code { font-family: monospace; background-color: #f4f4f4; padding: 5px; border-radius: 3px; }
        .vulnerable { background-color: #fff3cd; color: #856404; padding: 5px; border: 1px solid #ffeeba; }
    </style>
</head>
<body>
<header>
    <h1>Web Security Education Lab</h1>
    <nav>
    {% if session.username %}
        <strong>Logged in:</strong> {{ session.username }} ({{ session.role }}) |
        <a href='/security'>Security Dashboard</a>
        <a href='/feedback'>Feedback</a>
        {% if session.role == 'admin' %}
            <a href='/admin/review'>Admin Review</a>
            <a href='/admin/dashboard'>Admin Dashboard</a>
        {% else %}
            <a href='/shop'>Shop</a>
            <a href='/profile'>Profile</a>
        {% endif %}
        <a href='/attacker'>Attacker View</a> | 
        <a href='/logout'>Logout</a>
    {% else %}
        <a href='/login'>Login</a> | 
        <a href='/feedback'>Feedback</a> |
        <a href='/security'>Security Overview</a>
    {% endif %}
    </nav>
</header>
<hr>

<h2>Security Dashboard</h2>

<div class="security-status">
    <h3>Current Protection Status</h3>
    <p>XSS Protection: <span class="{% if protections.XSS %}security-enabled{% else %}security-disabled{% endif %}">
        {{ protections.XSS }}</span></p>
    <p>SQL Injection Protection: <span class="{% if protections.SQLi %}security-enabled{% else %}security-disabled{% endif %}">
        {{ protections.SQLi }}</span></p>
    <p>CSRF Protection: <span class="{% if protections.CSRF %}security-enabled{% else %}security-disabled{% endif %}">
        {{ protections.CSRF }}</span></p>
    <p>Secure Cookies: <span class="{% if protections.SecureCookies %}security-enabled{% else %}security-disabled{% endif %}">
        {{ protections.SecureCookies }}</span></p>
    
    {% if session.role == 'admin' %}
    <p>
        <a href="{{ url_for('toggle_protection', protection_type='xss') }}">Toggle XSS Protection</a> |
        <a href="{{ url_for('toggle_protection', protection_type='sqli') }}">Toggle SQLi Protection</a> |
        <a href="{{ url_for('toggle_protection', protection_type='csrf') }}">Toggle CSRF Protection</a> |
        <a href="{{ url_for('toggle_protection', protection_type='cookies') }}">Toggle Secure Cookies</a>
    </p>
    {% endif %}
</div>

<div>
    <h3>Learning Resources</h3>
    <ul>
        <li><a href="{{ url_for('xss_tutorial') }}">XSS Tutorial</a></li>
        <li><a href="{{ url_for('sqli_tutorial') }}">SQL Injection Tutorial</a></li>
        <li><a href="{{ url_for('csrf_tutorial') }}">CSRF Tutorial</a></li>
    </ul>
</div>

<div>
    <h3>Recent Security Events</h3>
    {% if security_events %}
    <table>
        <tr><th>Time</th><th>Event Type</th><th>Details</th><th>IP Address</th></tr>
        {% for event_type, details, ip_address, ts in security_events %}
        <tr>
            <td>{{ ts }}</td>
            <td>{{ event_type }}</td>
            <td>{{ details }}</td>
            <td>{{ ip_address }}</td>
        </tr>
        {% endfor %}
    </table>
    {% else %}
    <p>No security events recorded yet.</p>
    {% endif %}
</div>

<hr>
<footer>
    <p><small>Educational Purpose Only - This application contains intentional vulnerabilities for learning about web security.</small></p>
</footer>
</body>
</html>
